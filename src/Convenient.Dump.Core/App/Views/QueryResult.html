<div ng-app="app" ng-controller="Ctrl as vm">
  <h1>@ViewBag.Title</h1>
  <div class="margin-s">
    <input type="text" placeholder="search" ng-model="vm.search.q" class="g100" ng-enter="vm.search()"/>
  </div>
  <div class="margin-s">
    <button type="button" class="btn" ng-click="vm.search()">Search</button>
  </div>
  <div class="margin-s">
    <table>
      <thead>
        <tr>
          <th>Id</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="item in vm.result.items">
          <td><a href="@BasePath@Path/{{item.getId()}}">{{item.getId()}}</a></td>
          <td><pre>{{item | json}}</pre></td>
        </tr>
      </tbody>
    </table>
  </div>
      
  <pre class="red" ng-show="!!vm.error">{{vm.error | json}}</pre>
</div>
<script id="model" type="text/json">@Model</script>
<script type="text/javascript">
  (function() {
    angular.module("app").controller("Ctrl", Ctrl);

    function Ctrl($http) {
      var vm = this;
      vm.search = {
        q:""
      };

      vm.search = function () {
        vm.error = null;
        $http({
          method: "GET",
          url: document.location.href,
          params: vm.search
        }).then(function (r) {
          setResult(r.data);
        }).catch(function (e) {
          vm.error = e.data;
        });
      }

      function getId() {
        return this._id || this.id || this.Id || this.ID;
      }

      function setResult(result) {
        result.items = result.Items || result.items || [];
        for (var ii = 0; ii < result.items.length; ii++) {
          var item = result.items[ii];
          item.getId = getId;
        }
        vm.result = result;
      }
      setResult(JSON.parse(document.getElementById("model").innerHTML) || {items:[]});
    }
  })();
</script>
